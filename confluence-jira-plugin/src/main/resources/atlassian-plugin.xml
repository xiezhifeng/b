<atlassian-plugin name='${project.name}' key='${atlassian.plugin.key}' plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <vendor name="Atlassian Pty Ltd" url="http://atlassian.com"/>
        <version>${project.version}</version>
    </plugin-info>
    
    <component-import key="applicationLinkService" interface="com.atlassian.applinks.api.ApplicationLinkService" />

    <component name="JIRA Issues Settings Manager" key="jiraIssuesSettingsManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesSettingsManager">
        <description>The component responsible for retrieving and storing settings related to {jiraissues}.</description>
    </component>

    <component name="JIRA Trust Configuration" key="trustedApplicationConfig" class="com.atlassian.confluence.extra.jira.DefaultTrustedApplicationConfig">
        <description>The component that will control whether trusted connections can be used at all for plugin modules.</description>
    </component>

    <!-- Components are StateAware, Spring beans are not -->
    <component name="JIRA application trust support" class="com.atlassian.confluence.extra.jira.JiraTrustComponent" key="jiratrust">
        <description>Send user authentication via trusted application link</description>
    </component>

    <component name="JIRA application trust warnings" class="com.atlassian.confluence.extra.jira.JiraTrustWarningsComponent" key="jiratrustwarnings">
        <description>Display warning messages when trusted user authentication is not available</description>
    </component>

    <component name="JIRA Issues Column Manager" key="jiraIssuesColumnManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesColumnManager">
        <description>The component responsible for managing JIRA issue column mapping and their attributes.</description>
    </component>

    <component name="JIRA Issues URL Manager" key="jiraIssuesUrlManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesUrlManager">
        <description>A component providing URL manipulation routines for other compnents related to {jiraissues}.</description>
    </component>

    <component name="JIRA Project Key Cache" key="projectKeyCache" class="com.atlassian.confluence.extra.jira.DefaultProjectKeyCache">
        <description>A component to manage the caching of project keys from linked jira servers</description>
    </component>

    <component name="JIRA Issues Manager" key="jiraIssuesManager" class="com.atlassian.confluence.extra.jira.CacheJiraIssuesManager" public="true">
        <interface>com.atlassian.confluence.extra.jira.JiraIssuesManager</interface>
        <description>The face of most 'managers' related to {jiraissues}.</description>
    </component>

    <component name="JIRA Issues JSON Generator" key="jsonFlexigridResponseGenerator" class="com.atlassian.confluence.extra.jira.JsonFlexigridResponseGenerator">
        <description>The component that translates JIRA issues XML into JSON for the {jiraissues} table JS widget.</description>
    </component>

    <component name="JIRA Issues Application Link Resolver" key="jiraIssuesAppLinkResolver" class="com.atlassian.confluence.extra.jira.ApplicationLinkResolver">
        <description>A helper class to find the AppLink for a particular instance of the JIRA Issue macro.</description>
    </component>

    <component name="JIRA Issues Date Formatter" key="jiraIssuesDateFormatter" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesDateFormatter">
        <description>A class to format date in different locale</description>
    </component>

    <macro name="jira" class="com.atlassian.confluence.extra.jira.StreamableJiraIssuesMacro" key="jira"
            icon="/download/resources/confluence.extra.jira/images/macro-icons.png">
        <description key="jira.macro.jira.description.legacy"/>
        <parameters/>
        <property-panel>
            <button id="view-in-jira" label="view.in.jira" action="#" />
        </property-panel>
    </macro>

     <macro name="jiraissues" hidden="true" class="com.atlassian.confluence.extra.jira.StreamableJiraIssuesMacro" key="jiraissues"
           icon="/download/resources/confluence.extra.jira/images/macro-icons.png">
        <description key="jira.macro.jira.issues.description.legacy"/>
    </macro> 

    <xhtml-macro name='jira' class='com.atlassian.confluence.extra.jira.StreamableJiraIssuesMacro' key='jira-xhtml'
                 icon="/download/resources/confluence.extra.jira/images/macro-icons.png" documentation-url="help.jira.issues.macro">
        <description key="jira.macro.jira.description"/>
        <device-type>mobile</device-type>
        <category name="external-content"/>
        <category name="development"/>
        <parameters>
            <default>
                <option key="showValueInPlaceholder" value="true" />
            </default>
            <parameter name="key" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="true" />
            </parameter>
            <parameter name="jqlQuery" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="true" />
            </parameter>
            <parameter name="server" type="string" required="true">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="false" />
            </parameter>
            <parameter name="serverId" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="false" />
            </parameter>
            <parameter name="serverUrl" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="false" />
            </parameter>
        </parameters>
        <property-panel>
            <button id="view-in-jira" label="view.in.jira" action="#" />
        </property-panel>
    </xhtml-macro>

    <xhtml-macro name="jiraissues" hidden="true" class="com.atlassian.confluence.extra.jira.StreamableJiraIssuesMacro" key="jiraissues-xhtml" documentation-url="help.jira.issues.macro"
                 icon="/download/resources/confluence.extra.jira/images/macro-icons.png">
        <description key="jira.macro.jira.issues.description"/>
        <device-type>mobile</device-type>
        <category name="external-content"/>
        <category name="development"/>
        <parameters>
            <parameter name="url" type="url" required="true"/>
            <parameter name="columns" type="string" />
            <parameter name="count" type="boolean"/>
            <parameter name="cache" type="enum" default="on">
                <value name="on"/>
                <value name="off"/>
            </parameter>
            <parameter name="anonymous" type="boolean" default="false"/>
            <parameter name="width" type="string" default="100%"/>
            <parameter name="height" type="int" default="480"/>
            <parameter name="title" type="string" />
            <parameter name="renderMode" type="enum" default="dynamic">
                <value name="dynamic"/>
                <value name="static"/>
            </parameter>
        </parameters>
    </xhtml-macro>

    <macro-migrator key="jiraissues-migration" macro-name="jiraissues" class="com.atlassian.confluence.extra.jira.JiraIssuesMacroMigrator" />

    <servlet name='Jira Issues Retriever' key='jira-issues-retriever' class='com.atlassian.confluence.extra.jira.JiraIssuesServlet'>
        <description>Servlet that retrives issues from a Jira instance</description>
        <url-pattern>/issue-retriever</url-pattern>
    </servlet>

    <servlet name="Jira Chart Proxy Servlet" key="jira-chart-proxy-servlet" class="com.atlassian.confluence.plugins.jira.ChartProxyServlet">
        <description>Proxy servlet that retrieve chart images from JIRA via gadget REST API</description>
        <url-pattern>/jira-chart-proxy</url-pattern>
    </servlet>

    <servlet name="Image Generator Servlet" key="countImagegenerator" class="com.atlassian.confluence.plugins.jira.ImageGeneratorServlet">
        <description>Generates a placeholder for provided text parameters for the status macro.</description>
        <url-pattern>/count-image-generator</url-pattern>
    </servlet>

    <resource type="download" name="images/" location="templates/extra/jira/images/"/>
    <resource type="download" name="flexigrid-images/" location="resources/flexigrid/css/flexigrid/images/"/>

    <resource type="i18n" name="i18n" location="resources/jiraissues" />

    <web-resource key="macro-browser-resources" name="Macro browser resources">
        <resource type="download" name="view-in-jira.js" location="templates/extra/jira/view-in-jira.js"/>
        <resource type="download" name="macro-icon.css" location="templates/extra/jira/macro-icon.css"/>
        <context>editor</context>
    </web-resource>

    <web-resource key="web-resources" name="Web resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="flexigrid.js" location="resources/flexigrid/flexigrid.js"/>
        <resource type="download" name="flexigrid.css" location="resources/flexigrid/css/flexigrid/flexigrid.css"/>
        <resource type="download" name="flexigrid-custom.css" location="templates/extra/jira/flexigrid-custom.css"/>
        <resource type="download" name="jiraIssues.js" location="templates/extra/jira/jiraIssues.js"/>
        <dependency>confluence.extra.jira:common-resources</dependency>
        <dependency>confluence.extra.jira:web-resources-adg</dependency>
        <context>atl.general</context>
    </web-resource>
    <web-resource key="web-resources-adg" name="ADG Web resources">
        <resource type="download" name="flexigrid-adg-override.css" location="resources/flexigrid/css/flexigrid-adg-override.css"/>
        <condition class="com.atlassian.confluence.plugin.descriptor.web.conditions.BuildNumberCondition">
            <param name="minBuildNumber">4000</param>
        </condition>
    </web-resource>
    <web-resource key="common-resources" name="Common resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="common.css" location="templates/extra/jira/common.css"/>
        <resource type="download" name="common.js" location="templates/extra/jira/common.js"/>
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-util-js</dependency> 
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-oauth-ui</dependency> 
    </web-resource>

    <!-- jira-connector atlassian-plugin.xml -->
    
    <web-resource key="jqlHelper" name="JQL helper">
        <description>Common JIRA Helper functions</description>
        <resource type="download" name="jqlhelper.js" location="/jira/jqlhelper.js" />
    </web-resource>
    
    <web-resource key="jiraAnalytics" name="JIRA analytics">
        <description>JIRA analytics component</description>
        <resource type="download" name="jiraanalytics.js" location="/jira/jiraanalytics.js" />
        <dependency>confluence.web.resources:page-editor</dependency>
        <dependency>com.atlassian.confluence.tinymceplugin:editor-resources</dependency>
        <context>editor</context>
    </web-resource>
    
    <web-resource key="dialogsJs">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

         <!-- transform Soy templates into JS -->
        <transformation extension="soy">
            <transformer key="soyTransformer">
                <functions>com.atlassian.confluence.plugins.soy:soy-core-functions</functions>
               </transformer>
        </transformation>

        <resource type="download" name="datatable.js" location="/jira/datatable.js" />
        <resource type="download" name="dialogs.js" location="/jira/dialogs.js" />
        <resource type="download" name="panelhelper.js" location="/jira/panelhelper.js" />
        <resource type="download" name="searchpanel.js" location="/jira/searchpanel.js" />
        <resource type="download" name="createissuepanel.js" location="/jira/createissuepanel.js" />
        <resource type="download" name="recentlyviewedpanel.js" location="/jira/recentlyviewedpanel.js" />
        <resource type="download" name="dialogs.css" location="/jira/dialogs.css" />
        <resource type="download" name="dialog-soy.js" location="templates/soy/dialog.soy"/>

        <context>editor</context>

        <dependency>confluence.web.resources:page-editor</dependency>
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-util-js</dependency> 
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-oauth-ui</dependency> 
        <dependency>confluence.extra.jira:proxy-js</dependency>  
        <dependency>confluence.extra.jira:jqlHelper</dependency>  
        <dependency>confluence.extra.jira:jiraAnalytics</dependency>  
        <dependency>com.atlassian.confluence.tinymceplugin:editor-resources</dependency>
        <resource type="download" name="16jira.png" location="/jira/16jira.png" />
        <resource type="download" name="bullets.png" location="/jira/bullets.png" />
        <resource type="download" name="jira-issues-count.png" location="/jira/jira-issues-count.png" />
    </web-resource>
    
    <!-- web resource for mobile -->
    <web-resource key="mobile-browser-resources" name="Mobile Macro browser resources">
        <resource type="download" name="mobile-macro.css" location="templates/mobile/extra/jira/mobile-macro.css"/>
    </web-resource>
    
    <web-resource key="autoconvert-jira" name="Autoconvert Jira">
        <description>Convert URLs from applinked Jira link to Jira macros.</description>
        <resource type="download" name="jirapaste.js" location="/jira/jirapaste.js"/>
        <dependency>com.atlassian.confluence.plugins.confluence-paste:autoconvert-core</dependency>
        <context>editor</context>
    </web-resource>
    
    <web-resource key="help-dialog-extension">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <dependency>com.atlassian.confluence.keyboardshortcuts:confluence-keyboard-shortcuts</dependency>
        <resource type="download" name="help-dialog.js" location="/jira/help-dialog.js" />

        <context>viewcontent</context>
        <context>main</context>
        <context>atl.admin</context>
    </web-resource>
    
	<resource type="download" name="jira-table.png" location="/jira/jira-table.png">
	    <param name="content-type" value="image/jpeg"/>
	</resource>
    <web-resource key="proxy-js">
        <resource type="download" name="proxy.js" location="/jira/proxy.js"/>   
        <dependency>confluence.web.resources:ajs</dependency>  
    </web-resource>

    <servlet name="AppLinks Proxy" key="applinksProxy"
        class="com.atlassian.confluence.plugins.jira.AppLinksProxyRequestServlet">
        <description>Proxy to connect to linked applications</description>    
        <url-pattern>/applinks/proxy</url-pattern>
    </servlet>
    
    <web-item key="editor-featured-macro-jira" name="Insert Menu Link - JIRA issue" section="system.editor.featured.macros.default" weight="10">
        <description>Displays an insert JIRA issue link in the tinymce insert menu</description>
        <label key="jira.issue"/>
        <link linkId="jiralink"/>
    </web-item>

    <!-- <component-import key="applicationLinkService" interface="com.atlassian.applinks.api.ApplicationLinkService" />-->
    <component-import key="xhtmlContent" interface="com.atlassian.confluence.xhtml.api.XhtmlContent"/>
    <component-import key="settingsManager" interface="com.atlassian.confluence.setup.settings.SettingsManager"/>
    <component-import key="hostApplication" interface="com.atlassian.applinks.host.spi.HostApplication"/>
    <component-import key="eventPublisher" interface="com.atlassian.event.api.EventPublisher" />

    <rest key="servers" path="/jiraanywhere" version="1.0">
        <description>Provides services get list infor server in applink</description>
    </rest>

    <component key="confluenceEventListener" class="com.atlassian.confluence.plugins.jira.ConfluenceEventListener"/>
    <component key="jiraRemoteLinkCreator" class="com.atlassian.confluence.plugins.jira.JiraRemoteLinkCreator"/>
    
    <!-- JIRA CHART MACRO -->
    <macro name='jirachart' class='com.atlassian.confluence.plugins.jiracharts.JiraChartMacro' key='jirachart'>
        <description>JIRA Chart Macro</description>
    </macro>
    
    <xhtml-macro name='jirachart' class='com.atlassian.confluence.plugins.jiracharts.JiraChartMacro' key='jirachart-xhtml'
                 icon="/download/resources/confluence.extra.jira/images/jira-chart-macro-icon.png" documentation-url="help.jirachart.macro">
        <description key="jirachart.macro.description"/>
        <category name="development"/>
        <parameters>
            <parameter name="server" type="string" required="true">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="false" />
            </parameter>
        </parameters>
    </xhtml-macro>
    
    <web-resource key="jirachart-macro" name="JIRA Chart Macro">
        <description>process dialog for jira chart macro.</description>
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="soy">
            <transformer key="soyTransformer">
                <functions>com.atlassian.confluence.plugins.soy:soy-core-functions</functions>
               </transformer>
        </transformation>
        <resource type="download" name="jirachart-dialog.js" location="/jirachart/jirachart-dialog.js"/>
        <resource type="download" name="piechart-panel.js" location="/jirachart/piechart-panel.js"/>
        <context>editor</context>
    </web-resource>
    
    <web-resource key="jirachart-css">
        <resource type="download" name="bullets.png" location="/jirachart/bullets.png"/>
        <resource type="download" name="jirachart.css" location="/jirachart/jirachart.css"/>
        <context>page</context>
        <context>blogpost</context>
        <context>preview</context>
    </web-resource>
    
</atlassian-plugin>
