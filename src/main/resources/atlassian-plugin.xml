<atlassian-plugin name='${project.name}' key='${atlassian.plugin.key}'>
    <plugin-info>
        <description>${project.description}</description>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
        <version>${project.version}</version>
    </plugin-info>

    <spring name="JIRA Issues Settings Manager" key="jiraIssuesSettingsManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesSettingsManager">
        <description>The component responsible for retrieving and storing settings related to {jiraissues}.</description>
        <constructor-arg>
            <ref bean="transactionManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="bandanaManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="cacheManager"/>
        </constructor-arg>
    </spring>

    <spring name="JIRA Issues Column Manager" key="jiraIssuesColumnManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesColumnManager">
        <description>The component responsible for managing JIRA issue column mapping and their attributes.</description>
        <constructor-arg>
            <ref bean="jiraIssuesSettingsManager"/>
        </constructor-arg>
    </spring>

    <spring name="JIRA Issues URL Manager" key="jiraIssuesUrlManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesUrlManager">
        <description>A component providing URL manipulation routines for other compnents related to {jiraissues}.</description>
        <constructor-arg>
            <ref bean="jiraIssuesColumnManager"/>
        </constructor-arg>
    </spring>

    <spring name="JIRA Issues Icon Mapping Manager" key="jiraIssuesIconMappingManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesIconMappingManager">
        <description>The component that manages JIRA issue type to icon mapping.</description>
        <constructor-arg>
            <ref bean="jiraIssuesSettingsManager"/>
        </constructor-arg>
    </spring>

    <spring name="JIRA Issues Manager" key="jiraIssuesManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesManager">
        <description>The face of most 'managers' related to {jiraissues}.</description>
        <constructor-arg>
            <ref bean="jiraIssuesSettingsManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="jiraIssuesColumnManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="jiraIssuesUrlManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="jiraIssuesIconMappingManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="trustedTokenFactory"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="trustedConnectionStatusBuilder"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="httpRetrievalService"/>
        </constructor-arg>
        <constructor-arg value="org.apache.xerces.parsers.SAXParser"/>
    </spring>

    <spring name="JIRA Issues JSON Generator" key="jsonJiraIssuesResponseGenerator" class="com.atlassian.confluence.extra.jira.JsonJiraIssuesResponseGenerator">
        <description>The component that translates JIRA issues XML into JSON for the {jiraissues} JS widget.</description>
        <constructor-arg>
            <ref bean="userI18NBeanFactory"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="jiraIssuesManager"/>
        </constructor-arg>
        <constructor-arg>
            <ref bean="jiraIssuesColumnManager"/>
        </constructor-arg>
    </spring>

    <spring name="JIRA Issues Response Generator" key="jiraIssuesResponseGenerator" class="com.atlassian.confluence.extra.jira.DelegatingJiraIssuesResponseGenerator">
        <description>The component chooses an appropriate response translator for JIRA issues XML.</description>
        <constructor-arg>
            <ref bean="jsonJiraIssuesResponseGenerator"/>
        </constructor-arg>
    </spring>

    <macro name="jiraissues" class="com.atlassian.confluence.extra.jira.JiraIssuesMacro" key="jiraissues">
        <description>Macro to retrieve a feed of JIRA issues and summarise them in the page</description>
        <resource type="velocity" name="help" location="templates/extra/jira/jiraissues-help.vm">
            <param name="help-section" value="external"/>
        </resource>
    </macro>
    <macro name="jiraportlet" class="com.atlassian.confluence.extra.jira.PortletMacro" key="jiraportlet">
        <description>Macro to display a JIRA portlet - requires JIRA 3</description>
        <resource type="velocity" name="help" location="templates/extra/jira/jiraportlet-help.vm">
            <param name="help-section" value="external"/>
        </resource>
    </macro>

    <servlet name="JIRA Portlet servlet" key="jiraportlet-servlet" class="com.atlassian.confluence.extra.jira.PortletServlet">
        <description>Servlet for serving HTML processed by jiraportlet macro.</description>
        <url-pattern>/jiraportlet*</url-pattern>
    </servlet>


    <spring name="JIRA Trust Configuration" key="trustedApplicationConfig" class="com.atlassian.confluence.extra.jira.DefaultTrustedApplicationConfig">
        <description>The component that will control whether trusted connections can be used at all for plugin modules.</description>
    </spring>

    <!-- Components are StateAware, Spring beans are not -->
    <component name="JIRA application trust support" class="com.atlassian.confluence.extra.jira.JiraTrustComponent" key="jiratrust">
        <description>Send user authentication via trusted application link</description>
    </component>

    <component name="JIRA application trust warnings" class="com.atlassian.confluence.extra.jira.JiraTrustWarningsComponent" key="jiratrustwarnings">
        <description>Display warning messages when trusted user authentication is not available</description>
    </component>

    <servlet name='Jira Issues Retriever' key='jira-issues-retriever' class='com.atlassian.confluence.extra.jira.JiraIssuesServlet'>
        <description>Servlet that retrives issues from a Jira instance</description>
        <url-pattern>/issue-retriever</url-pattern>
    </servlet>

    <resource type="download" name="images/" location="templates/extra/jira/images/"/>
    <resource type="download" name="flexigrid-images/" location="resources/flexigrid/css/flexigrid/images/"/>
    <resource type="i18n" name="i18n" location="resources/jiraissues" />

    <web-resource key="web-resources" name="Web resources">
        <resource type="download" name="flexigrid.js" location="resources/flexigrid/flexigrid.js"/>
        <resource type="download" name="flexigrid.css" location="resources/flexigrid/css/flexigrid/flexigrid.css"/>
        <resource type="download" name="flexigrid-custom.css" location="templates/extra/jira/flexigrid-custom.css"/>
        <resource type="download" name="jiraIssues.js" location="templates/extra/jira/jiraIssues.js"/>
    </web-resource>

    <web-resource key="jiraportlet-javascript" name="JIRA Portlet JavaScript">
        <resource type="download" name="jiraportlet.js" location="templates/extra/jira/scripts/jiraportlet.js"/>
    </web-resource>

    <web-item key="browseiconmappings" name="Icon Mappings" section="system.admin/configuration" weight="100">
        <label key="jira.issues.icon.mappings" />
        <link>/admin/browseiconmappings.action</link>
    </web-item>

    <xwork name="Jiraissues icon mapping" key="jira.macros.plugin">
        <package name="jiraissues" extends="default" namespace="/admin">
        <default-interceptor-ref name="validatingStack" />

        <action name="browseiconmappings" class="com.atlassian.confluence.extra.jira.BrowseJiraIssuesMacroIconMappingsAction">
            <interceptor-ref name="defaultStack"/>
            <result name="success" type="velocity">/templates/extra/jira/browse_jira_issues_macro_icon_mappings.vm</result>
        </action>

        <action name="addiconmapping" class="com.atlassian.confluence.extra.jira.BrowseJiraIssuesMacroIconMappingsAction" method="doAddIconMapping">
            <result name="input" type="velocity">/templates/extra/jira/browse_jira_issues_macro_icon_mappings.vm</result>
            <result name="success" type="redirect">/admin/browseiconmappings.action</result>
        </action>

        <action name="removeiconmapping" class="com.atlassian.confluence.extra.jira.RemoveJiraIssuesMacroIconMappingsAction">
            <result name="input" type="velocity">/templates/extra/jira/browse_jira_issues_macro_icon_mappings.vm</result>
            <result name="success" type="redirect">/admin/browseiconmappings.action</result>
        </action>

        </package>
    </xwork>

</atlassian-plugin>
