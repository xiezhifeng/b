<atlassian-plugin name='${project.name}' key='${atlassian.plugin.key}' plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <vendor name="Atlassian Pty Ltd" url="http://atlassian.com"/>
        <version>${project.version}</version>
    </plugin-info>
    
    <component-import key="applicationLinkService" interface="com.atlassian.applinks.api.ApplicationLinkService" />
    
    <component name="JIRA Issues Settings Manager" key="jiraIssuesSettingsManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesSettingsManager">
        <description>The component responsible for retrieving and storing settings related to {jiraissues}.</description>
    </component>
    
    <component name="JIRA Trust Configuration" key="trustedApplicationConfig" class="com.atlassian.confluence.extra.jira.DefaultTrustedApplicationConfig">
        <description>The component that will control whether trusted connections can be used at all for plugin modules.</description>
    </component>

    <!-- Components are StateAware, Spring beans are not -->
    <component name="JIRA application trust support" class="com.atlassian.confluence.extra.jira.JiraTrustComponent" key="jiratrust">
        <description>Send user authentication via trusted application link</description>
    </component>

    <component name="JIRA application trust warnings" class="com.atlassian.confluence.extra.jira.JiraTrustWarningsComponent" key="jiratrustwarnings">
        <description>Display warning messages when trusted user authentication is not available</description>
    </component>

    <component name="JIRA Issues Column Manager" key="jiraIssuesColumnManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesColumnManager">
        <description>The component responsible for managing JIRA issue column mapping and their attributes.</description>
    </component>

    <component name="JIRA Issues URL Manager" key="jiraIssuesUrlManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesUrlManager">
        <description>A component providing URL manipulation routines for other compnents related to {jiraissues}.</description>
    </component>
     
    <component name="JIRA Project Key Cache" key="projectKeyCache" class="com.atlassian.confluence.extra.jira.DefaultProjectKeyCache">
        <description>A component to manage the caching of project keys from linked jira servers</description>
    </component>
    
    <component name="JIRA Issues Manager" key="jiraIssuesManager" class="com.atlassian.confluence.extra.jira.DefaultJiraIssuesManager">
        <description>The face of most 'managers' related to {jiraissues}.</description>
    </component>

    <component name="JIRA Issues JSON Generator" key="jsonFlexigridResponseGenerator" class="com.atlassian.confluence.extra.jira.JsonFlexigridResponseGenerator">
        <description>The component that translates JIRA issues XML into JSON for the {jiraissues} table JS widget.</description>
    </component>

    <macro name="jira" hidden="true" class="com.atlassian.confluence.extra.jira.JiraIssuesMacro" key="jira">
        <description key="jira.macro.jira.description.legacy"/>
        <parameters/>
        <property-panel>
            <button id="view-in-jira" label="view.in.jira" action="#" />
        </property-panel>
    </macro>
            
    <macro name="jiraissues" class="com.atlassian.confluence.extra.jira.JiraIssuesMacro" key="jiraissues">
        <description key="jira.macro.jira.issues.description.legacy"/>
    </macro>
    
    <macro name="jiraportlet" class="com.atlassian.confluence.extra.jira.PortletMacro" key="jiraportlet">
        <description key="jira.macro.jira.portlet.description.legacy"/>
    </macro>

    <xhtml-macro name='jira' hidden="true" class='com.atlassian.confluence.extra.jira.JiraIssuesMacro' key='jira-xhtml'>
        <description key="jira.macro.jira.description"/>
        <category name="external-content"/>
        <category name="development"/>
        <parameters>
            <default>
                <option key="showValueInPlaceholder" value="true" />            
            </default>
            <parameter name="key" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="true" />            
            </parameter>
            <parameter name="server" type="string">
                <option key="showKeyInPlaceholder" value="false" />
                <option key="showValueInPlaceholder" value="false" />            
            </parameter>
        </parameters>                
        <property-panel>
            <button id="view-in-jira" label="view.in.jira" action="#" />
        </property-panel>
    </xhtml-macro>

    <xhtml-macro name="jiraissues" class="com.atlassian.confluence.extra.jira.JiraIssuesMacro" key="jiraissues-xhtml"  documentation-url="help.jira.issues.macro">
        <description key="jira.macro.jira.issues.description"/>
        <category name="external-content"/>
        <category name="development"/>
        <parameters>
            <parameter name="url" type="url" required="true"/>
            <parameter name="columns" type="string">
                <!-- todo enum with multiple values? -->
                <!--<value name="key"/>-->
                <!--<value name="summary"/>-->
                <!--<value name="type"/>-->
                <!--<value name="created"/>-->
                <!--<value name="updated"/>-->
                <!--<value name="assignee"/>-->
                <!--<value name="reporter"/>-->
                <!--<value name="priority"/>-->
                <!--<value name="status"/>-->
                <!--<value name="resolution"/>-->
            </parameter>
            <parameter name="count" type="boolean"/>
            <parameter name="cache" type="enum" default="on">
                <value name="on"/>
                <value name="off"/>
            </parameter>
            <parameter name="anonymous" type="boolean" default="false"/>
            <parameter name="width" type="string" default="100%"/>
            <parameter name="height" type="int" default="480"/>
            <parameter name="title" type="string" />
            <parameter name="renderMode" type="enum" default="dynamic">
                <value name="dynamic"/>
                <value name="static"/>
            </parameter>
        </parameters>        
    </xhtml-macro>
    
    <macro-migrator key="jiraissues-migration" macro-name="jiraissues" class="com.atlassian.confluence.extra.jira.JiraIssuesMacroMigrator" />
    
    <xhtml-macro name="jiraportlet" hidden="true" class="com.atlassian.confluence.extra.jira.PortletMacro" key="jiraportlet-xhtml" documentation-url="help.jira.portlet.macro">
        <description key="jira.macro.jira.portlet.description"/>
        <parameters>
            <parameter name="url" type="url" required="true"/>
            <parameter name="anonymous" type="boolean"/>
            <parameter name="baseurl" type="url"/>
        </parameters>
    </xhtml-macro>

    <servlet name="JIRA Portlet servlet" key="jiraportlet-servlet" class="com.atlassian.confluence.extra.jira.PortletServlet">
        <description>Servlet for serving HTML processed by jiraportlet macro.</description>
        <url-pattern>/jiraportlet*</url-pattern>
    </servlet>
    
    <servlet name='Jira Issues Retriever' key='jira-issues-retriever' class='com.atlassian.confluence.extra.jira.JiraIssuesServlet'>
        <description>Servlet that retrives issues from a Jira instance</description>
        <url-pattern>/issue-retriever</url-pattern>
    </servlet>

    <resource type="download" name="images/" location="templates/extra/jira/images/"/>
    <resource type="download" name="flexigrid-images/" location="resources/flexigrid/css/flexigrid/images/"/>
    
    <resource type="i18n" name="i18n" location="resources/jiraissues" />
    
    <web-resource key="macro-browser-resources" name="Macro browser resources">
        <resource type="download" name="view-in-jira.js" location="templates/extra/jira/view-in-jira.js"/>
        <resource type="download" name="macro-icon.css" location="templates/extra/jira/macro-icon.css"/>
        <context>editor</context>
    </web-resource>
    
    <web-resource key="web-resources" name="Web resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="flexigrid.js" location="resources/flexigrid/flexigrid.js"/>
        <resource type="download" name="flexigrid.css" location="resources/flexigrid/css/flexigrid/flexigrid.css"/>
        <resource type="download" name="flexigrid-custom.css" location="templates/extra/jira/flexigrid-custom.css"/>
        <resource type="download" name="jiraIssues.js" location="templates/extra/jira/jiraIssues.js"/>
        <dependency>confluence.extra.jira:common-resources</dependency>
    </web-resource>
    
    <web-resource key="common-resources" name="Common resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="common.css" location="templates/extra/jira/common.css"/>
        <resource type="download" name="common.js" location="templates/extra/jira/common.js"/>
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-util-js</dependency> 
        <dependency>com.atlassian.applinks.applinks-plugin:applinks-oauth-ui</dependency> 
    </web-resource>

    <web-resource key="jiraportlet-javascript" name="JIRA Portlet JavaScript">
        <resource type="download" name="jiraportlet.js" location="templates/extra/jira/scripts/jiraportlet.js"/>
    </web-resource>

</atlassian-plugin>
